<!DOCTYPE html>
<html>
<head>
    <title>Guess Number Play - HABESHA GAMES</title>
    <style>
        /* ... (Your CSS styles) ... */
    </style>
</head>
<body>
    <h1>Guess Number Game</h1>
    <div class="game-box">
        <button onclick="startGame()">Start Game (Host)</button>
        <button onclick="askForGameId()">Join Game (Player)</button>
        <p id="gameIdDisplay"></p>
        <p>Enter your 4-digit guess (no 0s, no repeats):</p>
        <div class="input-row">
            <input id="g1" maxlength="1" type="number" min="1" max="9">
            <input id="g2" maxlength="1" type="number" min="1" max="9">
            <input id="g3" maxlength="1" type="number" min="1" max="9">
            <input id="g4" maxlength="1" type="number" min="1" max="9">
        </div>
        <button onclick="submitGuess()" id="submit-btn">Submit Guess</button>
        <div id="timer">Time left: 3:00</div>
        <div id="result"></div>
        <div id="history"></div>
        <button onclick="restartGame()">Restart</button>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.x.x/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.x.x/firebase-database-compat.js"></script>
    <script>
        const firebaseConfig = {
            // Replace with your Firebase config
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            databaseURL: "YOUR_DATABASE_URL",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let gameId;
        let isHost = false;
        let answer;

        function generateAnswer() {
            let digits = [1, 2, 3, 4, 5, 6, 7, 8, 9];
            let answer = '';
            for (let i = 0; i < 4; i++) {
                let randomIndex = Math.floor(Math.random() * digits.length);
                answer += digits.splice(randomIndex, 1)[0];
            }
            return answer;
        }

        function generateGameId() {
            return Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
        }

        function startGame() {
            isHost = true;
            gameId = generateGameId();
            answer = generateAnswer();
            database.ref('games/' + gameId).set({
                answer: answer,
                playerJoined: false,
                history: [],
                time: 180
            });
            document.getElementById('submit-btn').disabled = true;
            document.getElementById('gameIdDisplay').innerText = "Game ID: " + gameId;
            disableInputs();

            database.ref('games/' + gameId + '/playerJoined').on('value', snapshot => {
                if (snapshot.val()) {
                    enableInputs();
                    startTimer(gameId);
                }
            });
        }

        function askForGameId() {
            if (!isHost) {
                gameId = prompt("Enter game ID:");
                if (gameId) {
                    database.ref('games/' + gameId + '/playerJoined').set(true);
                    enableInputs();
                    startTimer(gameId);
                    database.ref('games/' + gameId + '/answer').on('value', snapshot => {
                        answer = snapshot.val();
                    });
                }
            }
        }

        function submitGuess() {
            const inputs = [g1.value, g2.value, g3.value, g4.value];
            const guess = inputs.join('');
            if (new Set(inputs).size !== 4 || guess.includes('0')) {
                alert("Guess must have 4 unique digits between 1-9");
                return;
            }

            let correctNum = 0;
            let correctPos = 0;

            for (let i = 0; i < 4; i++) {
                if (guess[i] === answer[i]) correctPos++;
                if (answer.includes(guess[i])) correctNum++;
            }

            document.getElementById('result').innerText = `Correct Numbers: ${correctNum}, Correct Positions: ${correctPos}`;

            const history = document.getElementById('history');
            history.innerText += `\nGuess: ${guess} â†’ Numbers: ${correctNum}, Positions: ${correctPos}`;
            database.ref('games/' + gameId + '/history').set(history.innerText);

            g1.value = g2.value = g3.value = g4.value = '';

            if (correctPos === 4) {
                document.getElementById('result').innerText = "Congratulations! You guessed the correct Number!";
                document.getElementById('submit-btn').disabled = true;
                clearInterval(window.timerInterval);
            }
        }

        function startTimer(gameId) {
            let totalSeconds = 180;
            const timerEl = document.getElementById("timer");
            window.timerInterval = setInterval(() => {
                totalSeconds--;
                const minutes = Math.floor(totalSeconds / 60);
                const seconds = totalSeconds % 60;
                timerEl.innerText = `Time left: ${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;

                if (totalSeconds <= 0) {
                    clearInterval(window.timerInterval);
                    timerEl.innerText = "Time's up! The correct number was " + answer;
                    document.getElementById("submit-btn").disabled = true;
                    database.ref('games/' + gameId + '/time').set(0);
                } else {
                    database.ref('games/' + gameId + '/time').set(totalSeconds);
                }
            }, 1000);
        }

        function restartGame() {
            if (confirm("Do you want to restart the game?")) {
                window.location.reload();
            }
        }
        function disableInputs() {
            document.getElementById('submit-btn').disabled = true;
            document.getElementById('g1').disabled = true;
            document.getElementById('g2').disabled = true;
            document.getElementById('g3').disabled = true;
            document.getElementById('g4').disabled = true;
        }
        function enableInputs() {
            document.getElementById('submit-btn').disabled = false;
            document.getElementById('g1').disabled = false;
            document.getElementById('g2').disabled = false;
            document.getElementById('g3').disabled = false;
            document.getElementById('g4').disabled = false;
        }
    </script>
</body>
</html>
