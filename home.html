<!DOCTYPE html>
<html>
<head>
  <title>Welcome Home</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding-top: 50px;
    }
  </style>
</head>
<body>
  <h1>Welcome, <span id="username">Loading...</span>!</h1>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCK1cWayLcccmgOmygFmW1otwlAPcrUSNw",
      authDomain: "habeshagames-1f999.firebaseapp.com",
      projectId: "habeshagames-1f999",
      storageBucket: "habeshagames-1f999.firebasestorage.app",
      messagingSenderId: "919693990773",
      appId: "1:919693990773:web:f32664a1b944b38101113c",
      measurementId: "G-G5C67RMJDY"
    };

    const app = initializeApp(firebaseConfig);
    const firestore = getFirestore(app);

    // Get telegram ID from previous login (URL or sessionStorage)
    const urlParams = new URLSearchParams(window.location.search);
    let telegramId = urlParams.get("id");

    // Optionally store it for later visits
    if (telegramId) {
      sessionStorage.setItem("telegramId", telegramId);
    } else {
      telegramId = sessionStorage.getItem("telegramId");
    }

    if (telegramId) {
      const userRef = doc(firestore, "users", telegramId);
      getDoc(userRef).then((docSnap) => {
        if (docSnap.exists()) {
          const data = docSnap.data();
          document.getElementById("username").textContent =
            data.firstName || data.username || "Friend";
        } else {
          document.getElementById("username").textContent = "Guest";
        }
      }).catch((err) => {
        console.error("Error loading user:", err);
        document.getElementById("username").textContent = "Error";
      });
    } else {
      document.getElementById("username").textContent = "Unknown";
    }
  </script>
</body>
</html>
